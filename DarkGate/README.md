# DarkGate: Dancing the Samba With Alluring Excel Files

## Table of Contents

1. [Introduction](#introduction)
2. [Executive Summary](#executive-summary)
3. [DarkGate Background](#darkgate-background)
4. [Conclusion](#conclusion)
5. [Product Protection](#product-protection)
6. [Source](#source)

---

## Introduction

- **Report Reference:** [DARKGR01] 
- **Summarized by:** [InfoSec]  
- **Analysis Date:** [2024/8/10]  
- **Report Date:** [2024/7/10]

<p align="center">
    <img src=".img/entry.png" alt="DarkGate: Dancing the Samba With Alluring Excel Files " />
</p>

---

## Executive Summary

This article reviews a DarkGate malware campaign from March-April 2024 that uses Microsoft Excel files to download a malicious software package from public-facing SMB file shares. This was a relatively short-lived campaign that illustrates how threat actors can creatively abuse legitimate tools and services to distribute their malware.

<p align="center">
    <img src=".img/excel.png" alt="Template used by .xlsx files used in this DarkGate campaign. " />
</p>

First reported in 2018, DarkGate has evolved into a malware-as-a-service (MaaS) offering. We have seen a surge of DarkGate activity after the disruption of Qakbot infrastructure in August 2023.

Palo Alto Networks customers are better protected from DarkGate and other malware families through our Next-Generation Firewall with Cloud-Delivered Security Services that include Advanced WildFire, Advanced URL Filtering and Advanced Threat Prevention. Cortex XDR can block malicious samples. The Prisma Cloud Defender Agent can detect the malware files referenced in this article using signatures generated by Advanced WildFire products and protect cloud-based VMs.

If you think you might have been compromised or have an urgent matter, contact the Unit 42 Incident Response team.

---

## DarkGate Background

DarkGate is a malware family first documented by enSilo in 2018. At that time, this threat ran with an advanced command and control (C2) infrastructure staffed by human operators responding to notifications of newly infected machines that had contacted its C2 server.

DarkGate has since evolved to become a MaaS offering with a tightly controlled number of customers. DarkGate has advertised various capabilities including hidden virtual network computing (hVNC), remote code execution, cryptomining and reverse shell.

An account named RastaFarEye posts updates and project information about DarkGate on the underground cybercrime market in the Exploit.IN forum and the XSS.is forum. Shows an October 2023 post by RastaFarEye announcing fixes and features for DarkGate version 5.

<p align="center">
    <img src=".img/1.png" alt="Exploit.IN forum post by DarkGate developer RastaFarEye in October 2023 " />
</p>

DarkGate remained relatively under the radar until 2021. Our telemetry revealed a surge in DarkGate starting in September 2023 (shown in Figure 2), not too long after the multinational government disruption and takedown of Qakbot infrastructure in August 2023.

<p align="center">
    <img src=".img/2.png" alt="Exploit.IN forum post by DarkGate developer RastaFarEye in October 2023 " />
</p>

These campaigns use AutoIt or AutoHotkey scripts to infect victims with DarkGate. Our telemetry indicates this activity has been widespread across North America and Europe as well as significant portions of Asia.

As early as January 2024, DarkGate released its sixth major version, which was reported by Spamhaus as an updated sample that was identified as version 6.1.6.

Since August 2023, we have seen campaigns using various methods to distribute DarkGate malware, such as the following:

- Tricking victims into downloading the DarkGate installer from a link sent over Teams chat
- Using email attachments to get victims to download and run content from a cabinet (.cab) archive
- An infection chain that uses DLL side-loading by a legitimate program to install DarkGate
- PDF attachments with links to download ZIP archives that contain Windows shortcut (.lnk) files to retrieve and install DarkGate
- An infection chain that uses ZIP archives containing URL files to download and install DarkGate
- An infection chain that uses Java archive (.jar) files to infect vulnerable hosts with DarkGate
- Using HTML (.html) files to trick users into copying and pasting malicious scripts into the Windows Run bar to infect their hosts with DarkGate
- Malicious ads distributing DarkGate malware

Starting in March 2024, we saw a campaign using servers running open Samba file shares hosting files used for DarkGate infections. Our analysis for this article focuses on this campaign, which ran from March-April of 2024.

---

## Conclusion

DarkGate malware represents a significant and adaptable threat in the cybercrime ecosystem, possibly filling the gap left by the dismantlement of Qakbot after August 2023. With its multi-faceted attack vectors and evolution into a full-fledged MaaS offering, DarkGate demonstrates a high level of complexity and persistence.

Campaigns using this malware exhibit advanced infection techniques, leveraging both phishing strategies and approaches like exploiting publicly accessible Samba shares. As DarkGate continues to evolve and refine its methods of infiltration and resistance to analysis, it remains a potent reminder of the need for robust and proactive cybersecurity defenses.

---

## Product Protection

Palo Alto Networks customers are better protected from the threats discussed in this article through the following products:

- Cortex XDR blocks the DarkGate samples referenced in this post as well as the various stages and payloads, and it provides extensive protection through cloud-based static and dynamic analysis capabilities.
- Next-Generation Firewall with Cloud-Delivered Security Services including Advanced WildFire, Advanced URL Filtering and Advanced Threat Prevention are able to recognize these domains or C2 URLs as malicious. They can also instrument the full attack chain and identify the malicious behaviors and anti-sandbox evasions. Examples of signatures include:
  - Virus/Win32.WGeneric.efigim
  - Virus/Win32.WGeneric.efypas
  - Virus/Win32.WGeneric.efhzig
- Next Generation Firewall with the Advanced Threat Prevention security subscription can help block the attacks with best practices via the following Threat Prevention signature: 86902.
- The Prisma Cloud Defender Agent can detect the malware files referenced in this article using signatures generated by Advanced WildFire products and protect cloud-based VMs.

If you think you may have been compromised or have an urgent matter, get in touch with the Unit 42 Incident Response team or call:

- North America Toll-Free: 866.486.4842 (866.4.UNIT42)
- EMEA: +31.20.299.3130
- APAC: +65.6983.8730
- Japan: +81.50.1790.0200

Palo Alto Networks has shared these findings with our fellow Cyber Threat Alliance (CTA) members. CTA members use this intelligence to rapidly deploy protections to their customers and to systematically disrupt malicious cyber actors. Learn more about the Cyber Threat Alliance.

---

## Source

[DarkGate Malware Uses Excel Files](https://unit42.paloaltonetworks.com/darkgate-malware-uses-excel-files/)
