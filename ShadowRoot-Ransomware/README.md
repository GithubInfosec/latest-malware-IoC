# ShadowRoot Ransomware - Kötü Amaçlı Yazılım Analiz Raporu

## İçindekiler
1. Giriş
2. Teknik Analiz
   - PDF Eki
   - Zararlı URL
   - Aşama Yüklerinin Çalıştırılması
   - Packer Bilgisi
   - Gizlenmiş Fonksiyon ve Sınıf Adları
   - Oluşturulan Mutantlar/Mutex'ler
   - Şifreleme Süreci
3. Sonuç
4. Koruma Bildirimi

---

## 1. Giriş

**Rapor Referansı:** SRR01  
**Hazırlayan:** [InfoSec]   
**Analiz Tarihi:** [07/13/2024]  
**Rapor Tarihi:** [07/13/2024]

Bu rapor, Forcepoint Tehdit İstihbarat ekibi tarafından tespit edilen ShadowRoot ransomware grubunun analizine dayanmaktadır. ShadowRoot, kurban sistemlerine sızmak ve şifrelemek için çeşitli teknikler kullanan bir ransomware grubudur ve şifre çözme karşılığında fidye talep eder.

---

## 2. Teknik Analiz

### 2.1 PDF Eki
![PDF Attachment](.jpg/image.png)
---
Bu PDF, bir bağlantı içerir ve bu bağlantı, ele geçirilmiş bir GitHub hesabından exe yükünü indirir.  
URL: hxxps://raw[.]githubusercontent[.]com/kurumsaltahsilat/detayfatura/main/PDF.FaturaDetay_202407.exe
---
![Malicious URL from pdf](.jpg/image-1.png)

### 2.2 Zararlı URL ve Analiz
İndirilen dosya, 32 bit Borland Delphi 4.0 ile derlenmiş bir ikili dosyadır. Bu dosya analiz edilirken, "C:\TheDream\RootDesign.exe", "C:\TheDream\Uninstall.exe" ve "C:\TheDream\Uninstall.ini" konumlarına ek yükler bıraktığı görülmektedir. İkinci aşama olan rootdesign.exe, dotnet confuser core ver 1.6 ile korunmaktadır.
---
![packer info](.jpg/image-2.png)
---
Özel karakterlere ve rastgele adlara sahip sınıflar ve tüm fonksiyon adlarının gizlendiği görülmektedir. Bu genellikle güvenlik uygulamalarının geleneksel tespit tekniklerinden kaçınmak için kötü amaçlı yazılım yazarları tarafından tercih edilir ve .NET uygulamaları için açık kaynaklı bir koruyucudur.
---
![Obfuscated function and class name](.jpg/image-3.png)

### 2.3 Aşama Yüklerinin Çalıştırılması

PDF.FaturaDetay_202407.exe, yükü bıraktıktan sonra, RootDesign.exe'yi gizli modda çalıştırmak için başka bir gizli PowerShell komutunu yürütmek üzere PowerShell'i başlatır.
**Komut:**
“”C:\Windows\System32\cmd.exe" /c PowerShell.exe -windowstyle hidden powershell -c C:\TheDream\RootDesign.exe”

**Created mutants/mutex:**
Local\ZonesCacheCounterMutex
Local\ZonesLockedCacheCounterMutex
_SHuassist.mtx

### 2.4 Dropper Dosyalarla Şifreleme 
Bu bırakılan dosyalar, yeni PID'lerle hafızada kendi tekrarlayan iş parçacıklarını oluşturur ve şifrelemeye başlar. Tüm iş parçacığı etkinliğini "C:\TheDream\log.txt" kökünde "ApproveExit.dot" şeklinde bir yorum ekleyerek kaydeder. Bu tekrarlayan iş parçacıkları ayrıca bellek tüketimini artırır. Daha sonra, çeşitli sistem kritik olmayan PE ve ofis dosyalarını şifrelemeye ve bu dosyaları ".ShadowRoot" uzantısıyla yeniden adlandırmaya başlar ve masaüstüne readme.txt dosyasını bırakır.
---
![Encrypted files with ShadowRoot extension](.jpg/image-4.png)
---
Readme.txt, fidye notlarını Türkçe olarak gösterir ve şifrelenmiş dosyalar masaüstüne bırakılır. Doğrudan bir kripto cüzdan kimliği bilgisi verilmemiştir, ancak kurbanlardan fidye ödemeleri ve şifre çözme araçları için sağlanan e-posta adresi aracılığıyla iletişime geçmeleri istenmektedir. Recursive self-process creation tarafından gözlemlenen RootDesign.exe, dosyaların birden fazla kez şifrelenmesine ve daha yüksek bellek tüketimine neden olur. Ayrıca kökte birçok şifrelenmiş dosya kopyası bırakır. Kodda standart AESCryptoServiceProvider .Net sınıfı gözlemlenmiştir.
---
![.NET AES class](.jpg/image-5.png)
Bu .net derlenmiş ikili dosyalarda ve powershell scriptlerinde en yaygın kullanılan sınıftır.

### 2.5 Şifreleme Sonrası İletişim
![Readme.txt](.jpg/image-6.png)
---
SMTP[.]mail[.]ru üzerinden 587 numaralı portta C2 bağlantısı gerçekleştirir. Daha sonra şüpheli hesaplara e-posta hizmeti aracılığıyla ayrıntıları gönderir. Kullanıcı adı: kurumsal[.]tasilat @internet[.]ru aynı zamanda gönderen alan adı olarak da kullanılır.
---
![C2 connection](.jpg/image-7.png)

### 3 Özet
ShadowRoot Ransomware sahte PDF faturaları göndererek Türk işletmelerini hedef alıyor ve kullanıcıları kötü amaçlı bağlantılara tıklamaya zorluyor. Şüpheli Delphi yükünü indirir ve ardından dotnet confuser korumalı ikili dosya bırakır. Dosyaları ".ShadowRoot" uzantısıyla şifreler ve bir Rus SMTP posta sunucusuna bağlanır. Bu ransomware, büyük olasılıkla temel işlevsellik sergileyen deneyimsiz bir geliştiricinin çalışması olan nispeten ilkel bir yapıya sahip bir zaarlıdır.

### 4 Koruma Bildirimi
Forcepoint müşterileri bu tehdide karşı şu saldırı aşamalarında korunmaktadır:

Aşama 2 (Kışkırtma) – Bu saldırılarla ilişkili kötü amaçlı PDF ekleri tanımlanıp engellenir.
Aşama 5 (Dropper Dosyası) – Dropper dosyaları Forcepoint kötü amaçlı veritabanına eklenir ve engellenir.
Aşama 6 (Evine Çağrı) – Engellenen C2 kimlik bilgileri

**Kaynak**
https://www.forcepoint.com/blog/x-labs/shadowroot-ransomware-targeting-turkish-businesses
