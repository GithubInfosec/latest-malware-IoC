# ShadowRoot Ransomware - Kötü Amaçlı Yazılım Analiz Raporu

## İçindekiler
1. [Giriş](#giriş)
2. [Teknik Analiz](#teknik-analiz)
   - [PDF Eki](#pdf-eki)
   - [Zararlı URL](#zararlı-url)
   - [Aşama Yüklerinin Çalıştırılması](#aşama-yüklerinin-çalıştırılması)
   - [Packer Bilgisi](#packer-bilgisi)
   - [Gizlenmiş Fonksiyon ve Sınıf Adları](#gizlenmiş-fonksiyon-ve-sınıf-adları)
   - [Oluşturulan Mutantlar/Mutex'ler](#oluşturulan-mutantlarmutexler)
   - [Şifreleme Süreci](#şifreleme-süreci)
3. [Sonuç](#sonuç)
4. [Koruma Bildirimi](#koruma-bildirimi)

---

## Giriş

**Rapor Referansı:** SRR01  
**Hazırlayan:** [InfoSec]   
**Analiz Tarihi:** [07/13/2024]  
**Rapor Tarihi:** [07/13/2024]

Bu rapor, Forcepoint Tehdit İstihbarat ekibi tarafından tespit edilen ShadowRoot ransomware grubunun analizine dayanmaktadır. ShadowRoot, kurban sistemlerine sızmak ve şifrelemek için çeşitli teknikler kullanan bir ransomware grubudur ve şifre çözme karşılığında fidye talep eder.

---

## Teknik Analiz

### PDF Eki
![PDF Attachment](.jpg/image.png)

Bu PDF, bir bağlantı içerir ve bu bağlantı, ele geçirilmiş bir GitHub hesabından exe yükünü indirir.  
**URL:** hxxps://raw[.]githubusercontent[.]com/kurumsaltahsilat/detayfatura/main/PDF.FaturaDetay_202407.exe

![Malicious URL from pdf](.jpg/image-1.png)

### Zararlı URL ve Analiz
İndirilen dosya, 32 bit Borland Delphi 4.0 ile derlenmiş bir ikili dosyadır. Bu dosya analiz edilirken, "C:\TheDream\RootDesign.exe", "C:\TheDream\Uninstall.exe" ve "C:\TheDream\Uninstall.ini" konumlarına ek yükler bıraktığı görülmektedir. İkinci aşama olan rootdesign.exe, dotnet confuser core ver 1.6 ile korunmaktadır.

![packer info](.jpg/image-2.png)

Özel karakterlere ve rastgele adlara sahip sınıflar ve tüm fonksiyon adlarının gizlendiği görülmektedir. Bu genellikle güvenlik uygulamalarının geleneksel tespit tekniklerinden kaçınmak için kötü amaçlı yazılım yazarları tarafından tercih edilir ve .NET uygulamaları için açık kaynaklı bir koruyucudur.

![Obfuscated function and class name](.jpg/image-3.png)

### Aşama Yüklerinin Çalıştırılması
PDF.FaturaDetay_202407.exe, yükü bıraktıktan sonra, RootDesign.exe'yi gizli modda çalıştırmak için başka bir gizli PowerShell komutunu yürütmek üzere PowerShell'i başlatır.

**Komut:**
“”C:\Windows\System32\cmd.exe" /c PowerShell.exe -windowstyle hidden powershell -c C:\TheDream\RootDesign.exe”


**Oluşturulan Mutantlar/Mutex'ler:**
- Local\ZonesCacheCounterMutex
- Local\ZonesLockedCacheCounterMutex
- _SHuassist.mtx

### Packer Bilgisi
Bu bırakılan dosyalar, yeni PID'lerle hafızada kendi tekrarlayan iş parçacıklarını oluşturur ve şifrelemeye başlar. Tüm iş parçacığı etkinliğini "C:\TheDream\log.txt" kökünde "ApproveExit.dot" şeklinde bir yorum ekleyerek kaydeder. Bu tekrarlayan iş parçacıkları ayrıca bellek tüketimini artırır. Daha sonra, çeşitli sistem kritik olmayan PE ve ofis dosyalarını şifrelemeye ve bu dosyaları ".ShadowRoot" uzantısıyla yeniden adlandırmaya başlar ve masaüstüne readme.txt dosyasını bırakır.

![Encrypted files with ShadowRoot extension](.jpg/image-4.png)

### Gizlenmiş Fonksiyon ve Sınıf Adları
Özel karakterlere ve rastgele adlara sahip sınıflar ve tüm fonksiyon adlarının gizlendiği görülmektedir. Bu genellikle güvenlik uygulamalarının geleneksel tespit tekniklerinden kaçınmak için kötü amaçlı yazılım yazarları tarafından tercih edilir ve .NET uygulamaları için açık kaynaklı bir koruyucudur.

![Obfuscated function and class name](.jpg/image-3.png)

### Şifreleme Süreci
ShadowRoot Ransomware, şifrelenmiş dosyaları masaüstüne bırakır ve Türkçe fidye notlarını içeren readme.txt dosyasını kullanıcıya gösterir. Dosyaları ".ShadowRoot" uzantısıyla şifreler ve bir Rus SMTP sunucusuna bağlanır.

![Readme.txt](.jpg/image-6.png)

### Sonuç
ShadowRoot Ransomware sahte PDF faturaları göndererek Türk işletmelerini hedef alıyor ve kullanıcıları kötü amaçlı bağlantılara tıklamaya zorluyor. Şüpheli Delphi yükünü indirir ve ardından dotnet confuser korumalı ikili dosya bırakır. Dosyaları ".ShadowRoot" uzantısıyla şifreler ve bir Rus SMTP posta sunucusuna bağlanır. Bu ransomware, büyük olasılıkla temel işlevsellik sergileyen deneyimsiz bir geliştiricinin çalışması olan nispeten ilkel bir yapıya sahip bir zararlıdır.

### Koruma Bildirimi
Forcepoint müşterileri bu tehdide karşı şu saldırı aşamalarında korunmaktadır:

- **Aşama 2 (Kışkırtma):** Bu saldırılarla ilişkili kötü amaçlı PDF ekleri tanımlanıp engellenir.
- **Aşama 5 (Dropper Dosyası):** Dropper dosyaları Forcepoint kötü amaçlı veritabanına eklenir ve engellenir.
- **Aşama 6 (Evine Çağrı):** Engellenen C2 kimlik bilgileri

**Kaynak:** [Forcepoint Blog - ShadowRoot Ransomware Targeting Turkish Businesses](https://www.forcepoint.com/blog/x-labs/shadowroot-ransomware-targeting-turkish-businesses)
